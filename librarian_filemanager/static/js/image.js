// Generated by CoffeeScript 1.10.0
(function(window, $, templates) {
  'use strict';
  var LEFT_ARROW, RIGHT_ARROW, SPACE, gallery, handleKeyEvent, prepareGallery;
  LEFT_ARROW = 37;
  RIGHT_ARROW = 39;
  SPACE = 32;
  gallery = {
    initialize: function(container) {
      var currentItemClass, options;
      this.container = container;
      this.currentImage = this.container.find('.gallery-current-image img').first();
      this.currentImageLabel = this.container.find('#playlist-metadata .playlist-item-title').first();
      this.container.find('#gallery-control-previous').click((function(_this) {
        return function(e) {
          e.preventDefault();
          e.stopPropagation();
          _this.previous();
        };
      })(this));
      this.container.find('#gallery-control-next').click((function(_this) {
        return function(e) {
          e.preventDefault();
          e.stopPropagation();
          _this.next();
        };
      })(this));
      this.container.attr('tabindex', -1);
      this.container.focus();
      currentItemClass = 'gallery-list-item-current';
      options = {
        itemSelector: '#playlist-list .gallery-list-item',
        currentItemClass: currentItemClass,
        currentItemSelector: '.' + currentItemClass,
        toggleSidebarOnSelect: false,
        setCurrent: (function(_this) {
          return function(current, previous) {
            return _this.onSetCurrent(current, previous);
          };
        })(this)
      };
      this.playlist = new Playlist(this.container, options);
    },
    onSetCurrent: function(current, previous) {
      var image_url, nextUrl, previousUrl, title;
      title = current.data('title');
      image_url = current.data('direct-url');
      this.currentImage.attr({
        'src': image_url,
        'title': title,
        'alt': title
      });
      this.currentImageLabel.html(title);
      previousUrl = previous.data('url');
      nextUrl = current.data('url');
      if (previousUrl !== nextUrl) {
        window.changeLocation(nextUrl);
      }
    },
    next: function() {
      this.playlist.next();
      this.container.focus();
    },
    previous: function() {
      this.playlist.previous();
      this.container.focus();
    }
  };
  handleKeyEvent = function(e) {
    var ref;
    gallery = e.data;
    if ((ref = e.which) === RIGHT_ARROW || ref === SPACE) {
      gallery.next();
    } else if (e.which === LEFT_ARROW) {
      gallery.previous();
    }
  };
  prepareGallery = function() {
    var galleryContainer;
    galleryContainer = $('#views-container');
    if (!galleryContainer.length) {
      return;
    }
    gallery.initialize(galleryContainer);
    galleryContainer.on('keydown', gallery, handleKeyEvent);
  };
  $(prepareGallery);
  window.onTabChange(prepareGallery);
})(this, this.jQuery);
