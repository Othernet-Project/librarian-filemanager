// Generated by CoffeeScript 1.10.0
(function(window, $, templates) {
  'use strict';
  var Gallery, gallery, galleryContainer;
  Gallery = (function() {
    var currentItemClass;

    currentItemClass = 'gallery-list-item-current';

    function Gallery(container) {
      var i, image, index, j, len, ref;
      this.container = container;
      this.currentImage = this.container.find('.gallery-current-image-img').first();
      this.currentImageLabel = this.container.find('#gallery-controls-image-title').first();
      this.imagesList = this.container.find('#gallery-list .gallery-list-item');
      this.currentIndex = index = -1;
      ref = this.imagesList;
      for (i = j = 0, len = ref.length; j < len; i = ++j) {
        image = ref[i];
        if ($(image).hasClass(this.currentItemClass)) {
          index = i;
          break;
        }
      }
      if (index === -1) {
        index = 0;
      }
      this.moveTo(index);
      this.imagesList.on('click', 'a', (function(_this) {
        return function(e) {
          _this.onClick(e);
        };
      })(this));
    }

    Gallery.prototype.updateImage = function(newIndex) {
      var image_url, item, prevItem, title;
      if (this.currentIndex && this.currentIndex >= 0) {
        prevItem = $(this.imagesList.get(this.currentIndex));
        prevItem.removeClass(this.currentItemClass);
      }
      this.currentIndex = newIndex;
      item = $(this.imagesList.get(this.currentIndex));
      item.addClass(this.currentItemClass);
      title = item.data('title');
      image_url = item.data('direct-url');
      this.currentImage.attr({
        'src': image_url,
        'title': title,
        'alt': title
      });
      this.currentImageLabel.html(title);
    };

    Gallery.prototype.moveTo = function(index) {
      if (index < 0 || index >= this.imagesList.length) {
        return;
      }
      return this.updateImage(index);
    };

    Gallery.prototype.next = function() {
      var index;
      index = (this.currentIndex + 1) % this.imagesList.length;
      return this.moveTo(index);
    };

    Gallery.prototype.previous = function() {
      var index;
      index = (this.imagesList.length + this.currentIndex - 1) % this.imagesList.length;
      return this.moveTo(index);
    };

    Gallery.prototype.onClick = function(e) {
      var item;
      e.preventDefault();
      e.stopPropagation();
      item = $(e.target).closest('li');
      this.moveTo(this.imagesList.index(item));
      return false;
    };

    return Gallery;

  })();
  galleryContainer = $('#gallery-container');
  gallery = new Gallery(galleryContainer);
  $('#gallery-controls-control-previous').click(function() {
    gallery.previous();
  });
  $('#gallery-controls-control-next').click(function() {
    gallery.next();
  });
})(this, this.jQuery);
