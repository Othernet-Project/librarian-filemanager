// Generated by CoffeeScript 1.10.0
(function(window, $, templates) {
  'use strict';
  var VideoPlayer, prepareVideo;
  VideoPlayer = (function() {
    function VideoPlayer(container1) {
      var options;
      this.container = container1;
      options = {
        itemSelector: '#clips-list .clips-list-item',
        currentItemSelector: 'clips-list-item-current',
        ready: (function(_this) {
          return function() {
            _this.onReady();
          };
        })(this),
        setCurrent: (function(_this) {
          return function(item) {
            _this.onSetCurrent(item);
          };
        })(this)
      };
      this.clips = new Playlist(this.container, options);
      return;
    }

    VideoPlayer.prototype.onReady = function(func) {
      this.controls = this.container.find('#video-controls-video').first();
      return this.controls.mediaelementplayer({
        features: ['prevtrack', 'playpause', 'nexttrack', 'progress', 'duration', 'volume'],
        success: func,
        error: (function(_this) {
          return function() {
            return _this.controls.prepend(templates.videoLoadFailure);
          };
        })(this)
      });
    };

    VideoPlayer.prototype.onSetCurrent = function(item) {
      this.updatePlayer(item);
      window.updateLocation(item.data('url'));
    };

    VideoPlayer.prototype.updatePlayer = function(item) {
      var audio_url, height, ref, wasPlaying, width;
      audio_url = item.data('direct-url');
      ref = [item.data('width'), item.data('height')], width = ref[0], height = ref[1];
      wasPlaying = !this.controls.paused;
      if (wasPlaying) {
        this.controls.pause();
      }
      this.controls.setSrc(audio_url);
      this.controls.setVideoSize(width, height);
      if (wasPlaying) {
        this.controls.play();
      }
    };

    return VideoPlayer;

  })();
  prepareVideo = function() {
    var container, player;
    container = $('#clips-container');
    if (container.length) {
      player = new VideoPlayer(container);
    }
  };
  $(prepareVideo);
  window.onTabChange(prepareVideo);
})(this, this.jQuery, this.templates);
